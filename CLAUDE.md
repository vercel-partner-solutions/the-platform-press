# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Important Next.js Updates

- **Middleware**: Next.js now uses `proxy.ts` instead of `middleware.ts` for middleware functionality. All middleware logic should be implemented in the `proxy.ts` file at the root of the project.
- **Draft Mode**: The site supports draft mode via the `__prerender_bypass` cookie. When this cookie is present, article pages are routed to `/[locale]/articles/[slug]/preview` and fetch draft content from Contentful.

## Development Commands

- **Development server**: `npm run dev` - Start Next.js development server
- **Build**: `npm run build` - Build for production 
- **Lint**: `npm run lint` - Run ESLint (note: currently ignores build errors)
- **Start production**: `npm run start` - Start production server
- **Fetch Contentful Schema**: `npm run fetch-schema` - Fetch and update schema.json from Contentful

## Contentful Schema Management

This project uses Contentful as its CMS and maintains a `schema.json` file in the project root that contains the current Contentful content types schema.

### Important Schema Rules

- **NEVER manually edit `schema.json`** - This file is automatically generated and should only be updated via the fetch-schema script
- The schema file is used by AI tools like Claude to understand the current Contentful structure for better code generation
- Always run `npm run fetch-schema` after making changes to content types in Contentful to keep the schema file in sync

### Schema Script Location

The schema fetching functionality is located in:
- **Script**: `scripts/fetch-contentful-schema.ts` - Standalone script that connects to Contentful Management API
- **Command**: `npm run fetch-schema` - Runs the script using tsx to execute TypeScript directly

### Environment Variables Required

The fetch-schema script requires these environment variables:
- `CONTENTFUL_CMA_TOKEN` - Contentful Management API token
- `CONTENTFUL_SPACE_ID` - Contentful space identifier

## Project Architecture

This is a **Next.js 15** news website called "The Platform Press" built with:

- **Framework**: Next.js 15 with App Router
- **TypeScript**: Full TypeScript configuration with strict mode
- **Styling**: Tailwind CSS with custom design system and shadcn/ui components
- **UI Library**: Radix UI primitives with shadcn/ui component library
- **Package Manager**: Uses pnpm (based on pnpm-lock.yaml)

### Directory Structure

```
app/                    # Next.js App Router pages
├── (articles)/[slug]/  # Dynamic article pages
├── category/[slug]/    # Category pages with search functionality
├── globals.css         # Global styles and Tailwind imports
└── page.tsx           # Homepage

components/
├── homepage/          # Homepage-specific sections
├── layout/           # Header, footer, navigation
├── ui/              # Reusable UI components (shadcn/ui)
└── theme-provider.tsx # Dark mode support

lib/
├── cms.ts            # Content management and data fetching
├── types.ts          # TypeScript interfaces
└── utils.ts          # Utility functions (cn, etc.)

scripts/
└── fetch-contentful-schema.ts # Contentful schema fetching utility

schema.json           # Auto-generated Contentful schema (DO NOT EDIT MANUALLY)
```

### Key Architectural Patterns

**Content Management**: Currently uses placeholder data in `lib/cms.ts` with functions like `getArticles()`, `getArticleBySlug()`. The code includes TODO comments indicating plans to integrate with a real CMS.

**Data Types**: Articles have properties including `id`, `slug`, `title`, `excerpt`, `content` (markdown/HTML), `category`, `author`, `datePublished`, `readingTimeMinutes`, `views`, and optional `isBreaking`/`isFeatured` flags.

**Component Organization**: 
- Homepage sections are modular (hero, breaking news, latest articles, popular articles, opinion articles, local news)
- Each section has its own component in `components/homepage/`
- Loading states are implemented with Suspense boundaries

**Styling System**: 
- Uses Tailwind with custom design tokens in `tailwind.config.ts`
- HSL color variables for theming support
- Custom font family: Poppins for headings
- Neutral color scheme as base color

**Path Aliases**: Uses `@/` for absolute imports configured in `tsconfig.json`

### Development Notes

- **Build Configuration**: TypeScript and ESLint errors are ignored during builds (`ignoreBuildErrors: true`, `ignoreDuringBuilds: true`)
- **Images**: Unoptimized images enabled for easier development
- **Theme Support**: Implements dark/light mode via `next-themes`
- **Component Library**: Uses shadcn/ui with Lucide React icons
- **CMS Integration**: Placeholder implementation ready for real CMS integration

### v0.dev Integration

This project was initially generated with v0.dev and maintains sync capabilities with the v0 platform for continued development.